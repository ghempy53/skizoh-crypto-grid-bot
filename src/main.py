#  #  #  #  #  #  #  #  #  #  #  #  #  #  #  #  #  #  #  #  Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†   #  #  #  #  #  #  #  #  #  #  #  #                            
#                                                          Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†                                #
# Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†    Ã†Ã†Ã†Ã†Ã†    Ã†Ã†Ã†Ã†Ã†Ã†  Ã†Ã†Ã†Ã†Ã†   Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†          Ã†Ã†Ã†Ã†Ã†Ã†     Ã†Ã†Ã†Ã†Ã†  #
# Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†   Ã†Ã†Ã†Ã†Ã†   Ã†Ã†Ã†Ã†Ã†Ã†   Ã†Ã†Ã†Ã†Ã†   Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†   Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†      Ã†Ã†Ã†Ã†Ã†Ã†     Ã†Ã†Ã†Ã†Ã†  #
# Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†   Ã†Ã†Ã†Ã†Ã†   Ã†Ã†Ã†Ã†Ã†    Ã†Ã†Ã†Ã†Ã†   Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã† Ã†Ã†Ã†Ã†Ã†        Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†    Ã†Ã†Ã†Ã†Ã†Ã†     Ã†Ã†Ã†Ã†Ã†  #
# Ã†Ã†Ã†Ã†Ã†     Ã†Ã†Ã†Ã†    Ã†Ã†Ã†Ã†Ã†  Ã†Ã†Ã†Ã†Ã†Ã†    Ã†Ã†Ã†Ã†Ã†          Ã†Ã†Ã†Ã†Ã†Ã† Ã†Ã†Ã†Ã†Ã†           Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†  Ã†Ã†Ã†Ã†Ã†Ã†     Ã†Ã†Ã†Ã†Ã†  #
# Ã†Ã†Ã†Ã†Ã†     Ã†Ã†Ã†     Ã†Ã†Ã†Ã†Ã† Ã†Ã†Ã†Ã†Ã†Ã†     Ã†Ã†Ã†Ã†Ã†         Ã†Ã†Ã†Ã†Ã†Ã†  Ã†Ã†Ã†Ã†Ã†     Ã†Ã†  Ã†Ã†    Ã†Ã†Ã†Ã†Ã†Ã† Ã†Ã†Ã†Ã†Ã†Ã†     Ã†Ã†Ã†Ã†Ã†  #
# Ã†Ã†Ã†Ã†Ã†     Ã†       Ã†Ã†Ã†Ã†Ã† Ã†Ã†Ã†Ã†Ã†      Ã†Ã†Ã†Ã†Ã†         Ã†Ã†Ã†Ã†Ã†   Ã†Ã†Ã†Ã†Ã†     Ã†Ã†  Ã†Ã†Ã†    Ã†Ã†Ã†Ã†Ã† Ã†Ã†Ã†Ã†Ã†Ã†     Ã†Ã†Ã†Ã†Ã†  #
# Ã†Ã†Ã†Ã†Ã†Ã†Ã†           Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†       Ã†Ã†Ã†Ã†Ã†        Ã†Ã†Ã†Ã†Ã†Ã†   Ã†Ã†Ã†Ã†Ã†     Ã†Ã†Ã† Ã†Ã†Ã†     Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†     Ã†Ã†Ã†Ã†Ã†  #
#  Ã†Ã†Ã†Ã†Ã†Ã†Ã†          Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†       Ã†Ã†Ã†Ã†Ã†       Ã†Ã†Ã†Ã†Ã†Ã†    Ã†Ã†Ã†Ã†Ã†     Ã†Ã†Ã† Ã†Ã†Ã†  Ã†  Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†  #
#    Ã†Ã†Ã†Ã†Ã†Ã†Ã†        Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†        Ã†Ã†Ã†Ã†Ã†       Ã†Ã†Ã†Ã†Ã†Ã†    Ã†Ã†Ã†Ã†Ã† Ã†Ã†Ã†Ã†        Ã†Ã†  Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†  #
#      Ã†Ã†Ã†Ã†Ã†Ã†Ã†      Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†        Ã†Ã†Ã†Ã†Ã†      Ã†Ã†Ã†Ã†Ã†Ã†     Ã†Ã†Ã†Ã†Ã†  Ã†Ã†Ã†       Ã†Ã†Ã†  Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†  #
#       Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†    Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†       Ã†Ã†Ã†Ã†Ã†      Ã†Ã†Ã†Ã†Ã†      Ã†Ã†Ã†Ã†Ã†   Ã†Ã†Ã†     Ã†Ã†Ã†   Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†     Ã†Ã†Ã†Ã†Ã†  #
#         Ã†Ã†Ã†Ã†Ã†Ã†Ã†   Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†      Ã†Ã†Ã†Ã†Ã†     Ã†Ã†Ã†Ã†Ã†Ã†       Ã†Ã†Ã†Ã†Ã†   Ã†Ã†Ã†Ã†Ã†Ã†Ã† Ã†Ã†Ã†  Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†     Ã†Ã†Ã†Ã†Ã†  #
#    Ã†Ã†     Ã†Ã†Ã†Ã†Ã†   Ã†Ã†Ã†Ã†Ã† Ã†Ã†Ã†Ã†Ã†Ã†     Ã†Ã†Ã†Ã†Ã†    Ã†Ã†Ã†Ã†Ã†Ã†        Ã†Ã†Ã†Ã†Ã†        Ã†Ã†Ã†Ã†Ã†Ã†  Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†     Ã†Ã†Ã†Ã†Ã†  #
#  Ã†Ã†Ã†Ã†     Ã†Ã†Ã†Ã†Ã†   Ã†Ã†Ã†Ã†Ã†  Ã†Ã†Ã†Ã†Ã†Ã†    Ã†Ã†Ã†Ã†Ã†   Ã†Ã†Ã†Ã†Ã†Ã†          Ã†Ã†Ã†Ã†Ã†        Ã†Ã†Ã†Ã†Ã†  Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†     Ã†Ã†Ã†Ã†Ã†  #
# Ã†Ã†Ã†Ã†Ã†     Ã†Ã†Ã†Ã†Ã†   Ã†Ã†Ã†Ã†Ã†   Ã†Ã†Ã†Ã†Ã†    Ã†Ã†Ã†Ã†Ã†   Ã†Ã†Ã†Ã†Ã†Ã†          Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†    Ã†Ã†Ã†  Ã†Ã†Ã†Ã† Ã†Ã†Ã†Ã†Ã†Ã†     Ã†Ã†Ã†Ã†Ã†  #
# Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†   Ã†Ã†Ã†Ã†Ã†   Ã†Ã†Ã†Ã†Ã†Ã†   Ã†Ã†Ã†Ã†Ã†  Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†   Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†      Ã†Ã†Ã†Ã† Ã†Ã†Ã†Ã†Ã†Ã†     Ã†Ã†Ã†Ã†Ã†  #
# Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†   Ã†Ã†Ã†Ã†Ã†    Ã†Ã†Ã†Ã†Ã†Ã†  Ã†Ã†Ã†Ã†Ã†  Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†    Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†    Ã†Ã†Ã†Ã†Ã† Ã†Ã†Ã†Ã†Ã†Ã†     Ã†Ã†Ã†Ã†Ã†  #
# Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†    Ã†Ã†Ã†Ã†Ã†     Ã†Ã†Ã†Ã†Ã†Ã† Ã†Ã†Ã†Ã†Ã†  Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†     Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†   Ã†Ã†Ã†Ã†Ã† Ã†Ã†Ã†Ã†Ã†Ã†     Ã†Ã†Ã†Ã†Ã†  #
# Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†   Ã†Ã†Ã†Ã†Ã†    Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†   Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†  #
# Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†  Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã† Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†  #
# Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã† Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†  #
#                                                                     Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†                  #
#                                                                       Ã†Ã†Ã†  Ã†Ã†Ã†Ã†Ã†Ã†Ã†                    #    
#                                                                        Ã†Ã†Ã†Ã†   Ã†Ã†Ã†                     #
#                                                                         Ã†Ã†Ã†Ã†Ã†Ã†Ã†Ã†                      #
#                                                                          Ã†Ã†Ã†Ã†Ã†Ã†                       #
#  #  #  #  #  #  #  #  #  #  #  #  #  #  #  #  #  #  #  #  #  #  #  #  #   Ã†Ã†Ã†Ã†   #  #  #  #  #  #  #  #

# =============================================================================
# SKIZOH CRYPTO GRID TRADING BOT v2.0 - Entry Point
# =============================================================================

import logging
import sys
import os
from pathlib import Path

# Setup paths
SCRIPT_DIR = Path(__file__).parent.resolve()
PROJECT_ROOT = SCRIPT_DIR.parent
DATA_DIR = PROJECT_ROOT / 'data'
DATA_DIR.mkdir(parents=True, exist_ok=True)

sys.path.insert(0, str(SCRIPT_DIR))

from grid_bot import SmartGridTradingBot
from config_manager import ConfigManager

# Configure logging
LOG_FILE = DATA_DIR / 'grid_bot.log'

logging.basicConfig(
    level=logging.INFO,
    format='%(asctime)s - %(levelname)s - %(message)s',
    handlers=[
        logging.FileHandler(str(LOG_FILE)),
        logging.StreamHandler()
    ]
)

logger = logging.getLogger(__name__)


def print_banner():
    """Display welcome banner."""
    print("\n" + "="*70)
    print("       SKIZOH CRYPTO GRID TRADING BOT v2.0")
    print("       Profit-Optimized Smart Trading")
    print("="*70)
    print("\nðŸš€ Key Features:")
    print("  â€¢ Asymmetric grid placement based on market bias")
    print("  â€¢ Dynamic spacing adapted to volatility")
    print("  â€¢ Grid efficiency scoring")
    print("  â€¢ Mean reversion probability")
    print("  â€¢ BNB fee discount support")
    print("  â€¢ Memory-optimized for Raspberry Pi")
    print("\n" + "="*70 + "\n")


def is_interactive():
    """Check if running interactively."""
    if not sys.stdin.isatty():
        return False
    if os.environ.get('GRIDBOT_NONINTERACTIVE', '').lower() in ('1', 'true', 'yes'):
        return False
    return True


def get_scenario_from_env(config_manager):
    """Get scenario from environment or config default."""
    scenarios = config_manager.scenarios
    scenario_env = os.environ.get('GRIDBOT_SCENARIO', '').strip()
    
    if scenario_env:
        # Try name match
        for scenario in scenarios:
            if scenario['name'].lower() == scenario_env.lower():
                return scenario
        # Try index
        try:
            idx = int(scenario_env)
            if 0 <= idx < len(scenarios):
                return scenarios[idx]
        except ValueError:
            pass
    
    # Use default from config
    default = config_manager.config.get('default_scenario', 'Balanced')
    for scenario in scenarios:
        if scenario['name'].lower() == default.lower():
            return scenario
    
    return scenarios[0]


def main():
    """Main entry point."""
    try:
        print_banner()
        
        config_path = SCRIPT_DIR / 'priv' / 'config.json'
        if not config_path.exists():
            print(f"âŒ Config not found: {config_path}")
            sys.exit(1)
        
        config_manager = ConfigManager(str(config_path))
        config = config_manager.load_config()
        
        if is_interactive():
            print("ðŸ–¥ï¸  Interactive mode\n")
            scenario = config_manager.select_scenario_interactive()
        else:
            scenario = get_scenario_from_env(config_manager)
            print(f"ðŸ³ Non-interactive mode")
            print(f"   Scenario: {scenario['name']}\n")
        
        # Initialize and run bot
        bot = SmartGridTradingBot(str(config_path))
        bot.run()
        
    except KeyboardInterrupt:
        logging.info("Stopped by user")
        sys.exit(0)
    except Exception as e:
        logging.error(f"Fatal error: {e}")
        import traceback
        traceback.print_exc()
        sys.exit(1)


if __name__ == "__main__":
    main()
